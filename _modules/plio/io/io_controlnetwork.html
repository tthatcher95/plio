<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>plio.io.io_controlnetwork &mdash; Planetary I/O</title>
    
    <link rel="stylesheet" type="text/css" href="../../../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../../../_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'Please install this project with setup.py',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/js/copybutton.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" >
    <link rel="search" title="Search" href="../../../search.html" >
    <link rel="top" title="Planetary I/O" href="../../../index.html" >
    <link rel="up" title="Module code" href="../../index.html" > 
  </head>
  <body>

  <div class="container">
    <div class="header">
    </div>
  </div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../../../index.html">Plio</a></li>
	
          <li class="active"><a href="../../index.html" accesskey="U">Module code</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../../../genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="../../../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/favicon.png" alt="Logo">
            </a></p>

        </div>
      </div>
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <h1>Source code for plio.io.io_controlnetwork</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">gmtime</span><span class="p">,</span> <span class="n">strftime</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pvl</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="kn">from</span> <span class="nn">plio.io</span> <span class="k">import</span> <span class="n">ControlNetFileV0002_pb2</span> <span class="k">as</span> <span class="n">cnf</span>
<span class="kn">from</span> <span class="nn">plio.io</span> <span class="k">import</span> <span class="n">ControlNetFileHeaderV0005_pb2</span> <span class="k">as</span> <span class="n">cnh5</span>
<span class="kn">from</span> <span class="nn">plio.io</span> <span class="k">import</span> <span class="n">ControlPointFileEntryV0005_pb2</span> <span class="k">as</span> <span class="n">cnp5</span>
<span class="kn">from</span> <span class="nn">plio.utils.utils</span> <span class="k">import</span> <span class="n">xstr</span><span class="p">,</span> <span class="n">find_in_dict</span>

<span class="n">HEADERSTARTBYTE</span> <span class="o">=</span> <span class="mi">65536</span>
<span class="n">DEFAULTUSERNAME</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>

<div class="viewcode-block" id="write_filelist"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.write_filelist">[docs]</a><span class="k">def</span> <span class="nf">write_filelist</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;fromlist.lis&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a filelist to a file so it can be used in ISIS3.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lst : list</span>
<span class="sd">          A list containing full paths to the images used, as strings.</span>
<span class="sd">    path : str</span>
<span class="sd">           The name of the file to write out. Default: fromlist.lis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="IsisControlNetwork"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.IsisControlNetwork">[docs]</a><span class="k">class</span> <span class="nc">IsisControlNetwork</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>

    <span class="c1"># normal properties</span>
    <span class="n">_metadata</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_constructor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IsisControlNetwork</span></div>

<span class="k">def</span> <span class="nf">from_isis</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">remove_empty</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="c1"># Now get ready to work with the binary</span>
    <span class="k">with</span> <span class="n">IsisStore</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span>

<div class="viewcode-block" id="to_isis"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.to_isis">[docs]</a><span class="k">def</span> <span class="nf">to_isis</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">serials</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">headerstartbyte</span><span class="o">=</span><span class="n">HEADERSTARTBYTE</span><span class="p">,</span>
            <span class="n">networkid</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">targetname</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">DEFAULTUSERNAME</span><span class="p">,</span>
            <span class="n">creation_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modified_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">pointid_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pointid_suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Write an AutoCNET Candidate graph object to an ISIS3 compatible control</span>
<span class="sd">    network.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">           Input path where the file is to be written</span>

<span class="sd">    network : dict</span>
<span class="sd">              A dict of lists keyed with a</span>

<span class="sd">    mode : {&#39;a&#39;, &#39;w&#39;, &#39;r&#39;, &#39;r+&#39;}</span>

<span class="sd">        ``&#39;r&#39;``</span>
<span class="sd">            Read-only; no data can be modified.</span>
<span class="sd">        ``&#39;w&#39;``</span>
<span class="sd">            Write; a new file is created (an existing file with the same</span>
<span class="sd">            name would be deleted).</span>
<span class="sd">        ``&#39;a&#39;``</span>
<span class="sd">            Append; an existing file is opened for reading and writing,</span>
<span class="sd">            and if the file does not exist it is created.</span>
<span class="sd">        ``&#39;r+&#39;``</span>
<span class="sd">            It is similar to ``&#39;a&#39;``, but the file must already exist.</span>

<span class="sd">    version : int</span>
<span class="sd">          The current ISIS version to write, defaults to 2</span>

<span class="sd">    headerstartbyte : int</span>
<span class="sd">                      The seek offset that the protocol buffer header starts at</span>

<span class="sd">    networkid : str</span>
<span class="sd">                The name of the network</span>

<span class="sd">    targetname : str</span>
<span class="sd">                 The name of the target, e.g. Moon</span>

<span class="sd">    description : str</span>
<span class="sd">                  A description for the network.</span>

<span class="sd">    username : str</span>
<span class="sd">               The name of the user / application that created the control network</span>

<span class="sd">    pointid_prefix : str</span>
<span class="sd">                     Prefix to be added to the pointid.  If the prefix is &#39;foo_&#39;, pointids</span>
<span class="sd">                     will be in the form &#39;foo_1, foo_2, ..., foo_n&#39;</span>

<span class="sd">    pointid_suffix : str</span>
<span class="sd">                     Suffix to tbe added to the point id.  If the suffix is &#39;_bar&#39;, pointids</span>
<span class="sd">                     will be in the form &#39;1_bar, 2_bar, ..., n_bar&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">IsisStore</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">creation_date</span><span class="p">:</span>
            <span class="n">creation_date</span> <span class="o">=</span> <span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">modified_date</span><span class="p">:</span>
            <span class="n">modified_date</span> <span class="o">=</span> <span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">())</span>
        <span class="n">point_messages</span><span class="p">,</span> <span class="n">point_sizes</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">create_points</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">serials</span><span class="p">,</span> <span class="n">pointid_prefix</span><span class="p">,</span> <span class="n">pointid_suffix</span><span class="p">)</span>
        <span class="n">points_bytes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">point_sizes</span><span class="p">)</span>
        <span class="n">buffer_header</span><span class="p">,</span> <span class="n">buffer_header_size</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">create_buffer_header</span><span class="p">(</span><span class="n">networkid</span><span class="p">,</span>
                                                                       <span class="n">targetname</span><span class="p">,</span>
                                                                       <span class="n">description</span><span class="p">,</span>
                                                                       <span class="n">username</span><span class="p">,</span>
                                                                       <span class="n">point_sizes</span><span class="p">,</span>
                                                                       <span class="n">creation_date</span><span class="p">,</span>
                                                                       <span class="n">modified_date</span><span class="p">)</span>
        <span class="c1"># Write the buffer header</span>
        <span class="n">store</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buffer_header</span><span class="p">,</span> <span class="n">HEADERSTARTBYTE</span><span class="p">)</span>
        <span class="c1"># Then write the points, so we know where to start writing, + 1 to avoid overwrite</span>
        <span class="n">point_start_offset</span> <span class="o">=</span> <span class="n">HEADERSTARTBYTE</span> <span class="o">+</span> <span class="n">buffer_header_size</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_messages</span><span class="p">):</span>
            <span class="n">store</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">point_start_offset</span><span class="p">)</span>
            <span class="n">point_start_offset</span> <span class="o">+=</span> <span class="n">point_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">create_pvl_header</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">headerstartbyte</span><span class="p">,</span> <span class="n">networkid</span><span class="p">,</span>
                                         <span class="n">targetname</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span>
                                         <span class="n">buffer_header_size</span><span class="p">,</span> <span class="n">points_bytes</span><span class="p">,</span>
                                         <span class="n">creation_date</span><span class="p">,</span> <span class="n">modified_date</span><span class="p">)</span>

        <span class="n">store</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="IsisStore"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.IsisStore">[docs]</a><span class="k">class</span> <span class="nc">IsisStore</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to manage IO of an ISIS control network (version 2).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    pointid : int</span>
<span class="sd">              The current index to be assigned to newly added points</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmeasures</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Conversion from buffer types to Python types</span>
        <span class="n">bt</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
              <span class="mi">5</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
              <span class="mi">8</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
              <span class="mi">9</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
              <span class="mi">11</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
              <span class="mi">14</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">bt</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">type</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">_CONTROLNETFILEHEADERV0002</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">bt</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">type</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">_CONTROLPOINTFILEENTRYV0002</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_attrs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">bt</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">type</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">_CONTROLPOINTFILEENTRYV0002_MEASURE</span><span class="o">.</span><span class="n">fields</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mode</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span> <span class="c1"># pragma: no cover</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>

<div class="viewcode-block" id="IsisStore.read"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.IsisStore.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an ISIS store, read the underlying ISIS3 compatible control network and</span>
<span class="sd">        return an IsisControlNetwork dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pvl_header</span> <span class="o">=</span> <span class="n">pvl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="n">header_start_byte</span> <span class="o">=</span> <span class="n">find_in_dict</span><span class="p">(</span><span class="n">pvl_header</span><span class="p">,</span> <span class="s1">&#39;HeaderStartByte&#39;</span><span class="p">)</span>
        <span class="n">header_bytes</span> <span class="o">=</span> <span class="n">find_in_dict</span><span class="p">(</span><span class="n">pvl_header</span><span class="p">,</span> <span class="s1">&#39;HeaderBytes&#39;</span><span class="p">)</span>
        <span class="n">point_start_byte</span> <span class="o">=</span> <span class="n">find_in_dict</span><span class="p">(</span><span class="n">pvl_header</span><span class="p">,</span> <span class="s1">&#39;PointsStartByte&#39;</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">find_in_dict</span><span class="p">(</span><span class="n">pvl_header</span><span class="p">,</span> <span class="s1">&#39;Version&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">_CONTROLPOINTFILEENTRYV0002</span><span class="o">.</span><span class="n">fields_by_name</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s1">&#39;measures&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cnf</span><span class="o">.</span><span class="n">_CONTROLPOINTFILEENTRYV0002_MEASURE</span><span class="o">.</span><span class="n">fields_by_name</span><span class="p">]</span>

            <span class="n">cp</span> <span class="o">=</span> <span class="n">cnf</span><span class="o">.</span><span class="n">ControlPointFileEntryV0002</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">header_start_byte</span><span class="p">)</span>
            <span class="n">pbuf_header</span> <span class="o">=</span> <span class="n">cnf</span><span class="o">.</span><span class="n">ControlNetFileHeaderV0002</span><span class="p">()</span>
            <span class="n">pbuf_header</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">header_bytes</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">point_start_byte</span><span class="p">)</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="n">cnf</span><span class="o">.</span><span class="n">ControlPointFileEntryV0002</span><span class="p">()</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">pbuf_header</span><span class="o">.</span><span class="n">pointMessageSizes</span><span class="p">:</span>
                <span class="n">cp</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_attrs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s1">&#39;measures&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="n">cp</span><span class="o">.</span><span class="n">measures</span><span class="p">:</span>
                    <span class="n">meas</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">+</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_attrs</span><span class="p">]</span>
                    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cnp5</span><span class="o">.</span><span class="n">_CONTROLPOINTFILEENTRYV0005</span><span class="o">.</span><span class="n">fields_by_name</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s1">&#39;measures&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cnp5</span><span class="o">.</span><span class="n">_CONTROLPOINTFILEENTRYV0005_MEASURE</span><span class="o">.</span><span class="n">fields_by_name</span><span class="p">]</span>

            <span class="n">cp</span> <span class="o">=</span> <span class="n">cnp5</span><span class="o">.</span><span class="n">ControlPointFileEntryV0005</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">header_start_byte</span><span class="p">)</span>
            <span class="n">pbuf_header</span> <span class="o">=</span> <span class="n">cnh5</span><span class="o">.</span><span class="n">ControlNetFileHeaderV0005</span><span class="p">()</span>
            <span class="n">pbuf_header</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">header_bytes</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">point_start_byte</span><span class="p">)</span>
            <span class="n">cp</span> <span class="o">=</span> <span class="n">cnp5</span><span class="o">.</span><span class="n">ControlPointFileEntryV0005</span><span class="p">()</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">byte_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">while</span> <span class="n">byte_count</span> <span class="o">&lt;</span> <span class="n">find_in_dict</span><span class="p">(</span><span class="n">pvl_header</span><span class="p">,</span> <span class="s1">&#39;PointsBytes&#39;</span><span class="p">):</span>
                <span class="n">message_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cp</span><span class="o">.</span><span class="n">ParseFromString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">message_size</span><span class="p">))</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_attrs</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s1">&#39;measures&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="n">cp</span><span class="o">.</span><span class="n">measures</span><span class="p">:</span>
                    <span class="n">meas</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">+</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_attrs</span><span class="p">]</span>
                    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>

                <span class="n">byte_count</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">message_size</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_attrs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_attrs</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">IsisControlNetwork</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">pvl_header</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="IsisStore.write"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.IsisStore.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : str</span>
<span class="sd">               to be written to the file</span>

<span class="sd">        offset : int</span>
<span class="sd">                 The byte offset into the output binary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="IsisStore.create_points"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.IsisStore.create_points">[docs]</a>    <span class="k">def</span> <span class="nf">create_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">serials</span><span class="p">,</span> <span class="n">pointid_prefix</span><span class="p">,</span> <span class="n">pointid_suffix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Step through a control network (C) and return protocol buffer point objects</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df : DataFrame</span>
<span class="sd">              with the appropriate attributes: point_id, point_type, serial,</span>
<span class="sd">              measure_type, x, y required.</span>
<span class="sd">              The entries in the list must support grouping by the point_id attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        point_messages : list</span>
<span class="sd">                         of serialized points buffers</span>

<span class="sd">        point_sizes : list</span>
<span class="sd">                      of integer point sizes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">_set_pid</span><span class="p">(</span><span class="n">pointid</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xstr</span><span class="p">(</span><span class="n">pointid_prefix</span><span class="p">),</span>
                                   <span class="n">pointid</span><span class="p">,</span>
                                   <span class="n">xstr</span><span class="p">(</span><span class="n">pointid_suffix</span><span class="p">))</span>

        <span class="c1"># TODO: Rewrite using apply syntax for performance</span>
        <span class="n">point_sizes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">point_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;point_id&#39;</span><span class="p">):</span>

            <span class="c1"># Get the point specification from the protobuf</span>
            <span class="n">point_spec</span> <span class="o">=</span> <span class="n">cnf</span><span class="o">.</span><span class="n">ControlPointFileEntryV0002</span><span class="p">()</span>

            <span class="c1"># Set the ID and then loop over all of the attributes that the</span>
            <span class="c1"># point has and check for corresponding columns in the group and</span>
            <span class="c1"># set with the correct type</span>
            <span class="c1">#point_spec.id = _set_pid(i)</span>
            <span class="n">point_spec</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">_set_pid</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attrtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="c1"># As per protobuf docs for assigning to a repeated field.</span>
                    <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;aprioriCovar&#39;</span><span class="p">:</span>
                        <span class="n">arr</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;aprioriCovar&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

                        <span class="n">point_spec</span><span class="o">.</span><span class="n">aprioriCovar</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">point_spec</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attrtype</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">attr</span><span class="p">]))</span>
            <span class="n">point_spec</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Hardcoded to free this is bad</span>

            <span class="c1"># The reference index should always be the image with the lowest index</span>
            <span class="n">point_spec</span><span class="o">.</span><span class="n">referenceIndex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># A single extend call is cheaper than many add calls to pack points</span>
            <span class="n">measure_iterable</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">measure_spec</span> <span class="o">=</span> <span class="n">point_spec</span><span class="o">.</span><span class="n">Measure</span><span class="p">()</span>
                <span class="c1"># For all of the attributes, set if they are an dict accessible attr of the obj.</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attrtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_attrs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">measure_spec</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attrtype</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">attr</span><span class="p">]))</span>
                <span class="n">measure_spec</span><span class="o">.</span><span class="n">serialnumber</span> <span class="o">=</span> <span class="n">serials</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">image_index</span><span class="p">]</span>
                <span class="n">measure_spec</span><span class="o">.</span><span class="n">sample</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span>
                <span class="n">measure_spec</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">y</span>
                <span class="n">measure_spec</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">measure_iterable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measure_spec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nmeasures</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">point_spec</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">measure_iterable</span><span class="p">)</span>
            <span class="n">point_message</span> <span class="o">=</span> <span class="n">point_spec</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>
            <span class="n">point_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_spec</span><span class="o">.</span><span class="n">ByteSize</span><span class="p">())</span>
            <span class="n">point_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">point_messages</span><span class="p">,</span> <span class="n">point_sizes</span></div>

<div class="viewcode-block" id="IsisStore.create_buffer_header"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.IsisStore.create_buffer_header">[docs]</a>    <span class="k">def</span> <span class="nf">create_buffer_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">networkid</span><span class="p">,</span> <span class="n">targetname</span><span class="p">,</span>
                             <span class="n">description</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">point_sizes</span><span class="p">,</span>
                             <span class="n">creation_date</span><span class="p">,</span>
                             <span class="n">modified_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the Google Protocol Buffer header using the</span>
<span class="sd">        protobuf spec.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        networkid : str</span>
<span class="sd">                    The user defined identifier of this control network</span>

<span class="sd">        targetname : str</span>
<span class="sd">                 The name of the target, e.g. Moon</span>

<span class="sd">        description : str</span>
<span class="sd">                  A description for the network.</span>

<span class="sd">        username : str</span>
<span class="sd">               The name of the user / application that created the control network</span>

<span class="sd">        point_sizes : list</span>
<span class="sd">                      of the point sizes for each point message</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        header_message : str</span>
<span class="sd">                  The serialized message to write</span>

<span class="sd">        header_message_size : int</span>
<span class="sd">                              The size of the serialized header, in bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_header_message</span> <span class="o">=</span> <span class="n">cnf</span><span class="o">.</span><span class="n">ControlNetFileHeaderV0002</span><span class="p">()</span>
        <span class="n">raw_header_message</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">creation_date</span>
        <span class="n">raw_header_message</span><span class="o">.</span><span class="n">lastModified</span> <span class="o">=</span> <span class="n">modified_date</span>
        <span class="n">raw_header_message</span><span class="o">.</span><span class="n">networkId</span> <span class="o">=</span> <span class="n">networkid</span>
        <span class="n">raw_header_message</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">raw_header_message</span><span class="o">.</span><span class="n">targetName</span> <span class="o">=</span> <span class="n">targetname</span>
        <span class="n">raw_header_message</span><span class="o">.</span><span class="n">userName</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">raw_header_message</span><span class="o">.</span><span class="n">pointMessageSizes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">point_sizes</span><span class="p">)</span>

        <span class="n">header_message_size</span> <span class="o">=</span> <span class="n">raw_header_message</span><span class="o">.</span><span class="n">ByteSize</span><span class="p">()</span>
        <span class="n">header_message</span> <span class="o">=</span> <span class="n">raw_header_message</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">header_message</span><span class="p">,</span> <span class="n">header_message_size</span></div>

<div class="viewcode-block" id="IsisStore.create_pvl_header"><a class="viewcode-back" href="../../../library/io/control.html#plio.io.io_controlnetwork.IsisStore.create_pvl_header">[docs]</a>    <span class="k">def</span> <span class="nf">create_pvl_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">headerstartbyte</span><span class="p">,</span>
                      <span class="n">networkid</span><span class="p">,</span> <span class="n">targetname</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span>
                          <span class="n">buffer_header_size</span><span class="p">,</span> <span class="n">points_bytes</span><span class="p">,</span>
                          <span class="n">creation_date</span><span class="p">,</span> <span class="n">modified_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the PVL header object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        version : int</span>
<span class="sd">              The current ISIS version to write, defaults to 2</span>

<span class="sd">        headerstartbyte : int</span>
<span class="sd">                          The seek offset that the protocol buffer header starts at</span>

<span class="sd">        networkid : str</span>
<span class="sd">                    The name of the network</span>

<span class="sd">        targetname : str</span>
<span class="sd">                     The name of the target, e.g. Moon</span>

<span class="sd">        description : str</span>
<span class="sd">                      A description for the network.</span>

<span class="sd">        username : str</span>
<span class="sd">                   The name of the user / application that created the control network</span>

<span class="sd">        buffer_header_size : int</span>
<span class="sd">                             Total size of the header in bytes</span>

<span class="sd">        points_bytes : int</span>
<span class="sd">                       The total number of bytes all points require</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">         : object</span>
<span class="sd">           An ISIS compliant PVL header object</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">encoder</span> <span class="o">=</span> <span class="n">pvl</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">IsisCubeLabelEncoder</span>

        <span class="n">header_bytes</span> <span class="o">=</span> <span class="n">buffer_header_size</span>
        <span class="n">points_start_byte</span> <span class="o">=</span> <span class="n">HEADERSTARTBYTE</span> <span class="o">+</span> <span class="n">buffer_header_size</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">pvl</span><span class="o">.</span><span class="n">PVLModule</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;ProtoBuffer&#39;</span><span class="p">,</span>
                <span class="p">({</span><span class="s1">&#39;Core&#39;</span><span class="p">:{</span><span class="s1">&#39;HeaderStartByte&#39;</span><span class="p">:</span> <span class="n">headerstartbyte</span><span class="p">,</span>
                        <span class="s1">&#39;HeaderBytes&#39;</span><span class="p">:</span> <span class="n">header_bytes</span><span class="p">,</span>
                        <span class="s1">&#39;PointsStartByte&#39;</span><span class="p">:</span> <span class="n">points_start_byte</span><span class="p">,</span>
                        <span class="s1">&#39;PointsBytes&#39;</span><span class="p">:</span> <span class="n">points_bytes</span><span class="p">},</span>

                  <span class="s1">&#39;ControlNetworkInfo&#39;</span><span class="p">:</span> <span class="n">pvl</span><span class="o">.</span><span class="n">PVLGroup</span><span class="p">([</span>
                        <span class="p">(</span><span class="s1">&#39;NetworkId&#39;</span><span class="p">,</span> <span class="n">networkid</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;TargetName&#39;</span><span class="p">,</span> <span class="n">targetname</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;UserName&#39;</span><span class="p">,</span> <span class="n">username</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;Created&#39;</span><span class="p">,</span> <span class="n">creation_date</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;LastModified&#39;</span><span class="p">,</span> <span class="n">modified_date</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="n">description</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;NumberOfPoints&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npoints</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;NumberOfMeasures&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmeasures</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
                        <span class="p">])</span>
                  <span class="p">}),</span>

                 <span class="p">)</span>
        <span class="p">])</span>

        <span class="k">return</span> <span class="n">pvl</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">encoder</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2017 - , Plio Developers.
      </li>
      <li>
      Last updated on May 01, 2019.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.0.1.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>